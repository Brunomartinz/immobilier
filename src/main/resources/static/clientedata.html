<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="clientecss.css" />
  <title>Fazer login</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="jquery.session.js"></script>
  <script src="jquery.md5.js"></script>
</head>


<body>
  <div class="container" id="container">
    <nav class="sidebar-navigation">
      <ul style="list-style-type: none;">
        <li class="active" style="margin-left: -40px;" id="altdados">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor"
            class="bi bi-bar-chart-steps" viewBox="0 0 16 16">
            <path
              d="M.5 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 .5 0zM2 1.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5v-1zm2 4a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1zm2 4a.5.5 0 0 1 .5-.5h6a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-6a.5.5 0 0 1-.5-.5v-1zm2 4a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1z" />
          </svg>
          <span class="tooltip">Meus dados</span>
        </li>
        <li style="margin-left: -40px;" id="altend">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-geo-alt"
            viewBox="0 0 16 16">
            <path
              d="M12.166 8.94c-.524 1.062-1.234 2.12-1.96 3.07A31.493 31.493 0 0 1 8 14.58a31.481 31.481 0 0 1-2.206-2.57c-.726-.95-1.436-2.008-1.96-3.07C3.304 7.867 3 6.862 3 6a5 5 0 0 1 10 0c0 .862-.305 1.867-.834 2.94zM8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10z" />
            <path d="M8 8a2 2 0 1 1 0-4 2 2 0 0 1 0 4zm0 1a3 3 0 1 0 0-6 3 3 0 0 0 0 6z" />
          </svg>
          <span class="tooltip">Endereços</span>
        </li>

        <li style="margin-left: -40px;" id="ednfaturamento">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-wallet2"
            viewBox="0 0 16 16">
            <path
              d="M12.136.326A1.5 1.5 0 0 1 14 1.78V3h.5A1.5 1.5 0 0 1 16 4.5v9a1.5 1.5 0 0 1-1.5 1.5h-13A1.5 1.5 0 0 1 0 13.5v-9a1.5 1.5 0 0 1 1.432-1.499L12.136.326zM5.562 3H13V1.78a.5.5 0 0 0-.621-.484L5.562 3zM1.5 4a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h13a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-13z" />
          </svg>
          <span class="tooltip">Faturamento</span>
        </li>
        <li style="margin-left: -40px;" id="logout">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-door-closed"
            viewBox="0 0 16 16">
            <path d="M3 2a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v13h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V2zm1 13h8V2H4v13z" />
            <path d="M9 9a1 1 0 1 0 2 0 1 1 0 0 0-2 0z" />
          </svg>
          <span class="tooltip">Logout</span>
        </li>
      </ul>
    </nav>
    <div class="form-container " id="altdadsf">
      <form onsubmit="return false" name="statusForm" id="editardadosusr">
        <h1>Alterar dados</h1>
        <input type="text" id="nome" placeholder="Nome" required  />
        <select id="genero" placeholder="Genero" required>
          <option value="maculino">maculino</option>
          <option value="Feminino">Feminino</option>
          <option value="Outro">Outro</option>
        </select>
        <input type="text" placeholder="Data de nascimento" id="nasc" onfocus="(this.type = 'date')" />

        <input type="password" placeholder="Senha" id="password" />
        <input type="password" placeholder="Confirme a senha" id="password2" />
        <input type="text" id="fsenha1" name="fsenha1" style="display: none;">
        <input type="text" id="fsenha2" name="fsenha2" style="display: none;">
        <p id="msgsenha"></p>
        <button id="alterar">Alterar</button>
      </form>
    </div>

    <div class="form-container " id="ednfaturamentos" style="display: none;">
      
      <form onsubmit="return false" id="formcadend2">
        <h1>Dados da fatura</h1>
        <input type="text" placeholder="CEP" required id="cep1" />
        <input type="text" placeholder="logradouro" disabled id="logradouro1" />
        <input type="text" placeholder="bairro" id="bairro1" disabled />
        <input type="text" placeholder="cidade" id="cidade1" disabled />
        <input type="text" placeholder="uf" id="uf1" disabled />
        <input type="text" placeholder="Número" id="numero1" required />

      </form>
    </div>

    <div class="table-container" style="display: none;" id="contTabela">

      <div class="div-cadastro">
        <h2>Endereços de entrega</h2>
        <button id="myBtn">Cadastrar endereço</button>
      </div>
      <ul class="responsive-table" id="dadso">
        <li class="table-header">
          <div class="col col-1">Logradouro</div>
          <div class="col col-2">Cidade</div>
          <div class="col col-3">UF</div>
          <div class="col col-4">Número</div>
          <div class="col col-5">Status</div>
          <div class="col col-7">Manutenção</div>
          <div class="col col-6">Principal</div>
        </li>

        <script type="text/javascript">
          $(document).ready(function () {
            $.ajax({
              type: "GET",
              url: "http://localhost:8082/endereco/" + localStorage.getItem('id'),
              mimeType: "json",
              cache: false,
              success: function (data) {
                $.each(data, function (i, data) {
                  var id = data.id;
                  var cep = data.cep;
                  var logradouro = data.logradouro;
                  var bairro = data.bairro;
                  var cidade = data.cidade;
                  var numero = data.numero;
                  var uf = data.uf;
                  var idClientne = data.Idcliente;
                  var status = data.status;
                  var principal = data.principal;
                  var body = "<li class='table-row' >";
                  body += "<div class='col col-1' data-label='Logradouro'>" + data.logradouro + "</div>";
                  body += "<div class='col col-2' data-label='Cidade'>" + data.cidade + "</div>";
                  body += "<div class='col col-3' data-label='UF'>" + data.uf + "</div>";
                  body += "<div class='col col-4' data-label='Número'>" + data.numero + "</div>";
                  body += "<div class='col col-7' data-label='Status'>" + data.status + "</div>";
                  if (data.status == true) {
                    stats = `<div class='col col-5' data-label='Status'><button onclick="alterarStatus('${id}', '${cep}', '${logradouro}','${numero}', '${bairro}', '${cidade}', '${uf}', '${status}', '${principal}','${i}')" id="botaos"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-on" viewBox="0 0 16 16">
                    <path d="M5 3a5 5 0 0 0 0 10h6a5 5 0 0 0 0-10H5zm6 9a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                    </svg></button></div>`;
                  } else {
                    stats = `<div class='col col-5' data-label='Status'><button onclick="alterarStatus('${id}', '${cep}', '${logradouro}','${numero}', '${bairro}', '${cidade}', '${uf}', '${status}', '${principal}', '${i}')" id="botaos"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-off" viewBox="0 0 16 16">
                    <path d="M11 4a4 4 0 0 1 0 8H8a4.992 4.992 0 0 0 2-4 4.992 4.992 0 0 0-2-4h3zm-6 8a4 4 0 1 1 0-8 4 4 0 0 1 0 8zM0 8a5 5 0 0 0 5 5h6a5 5 0 0 0 0-10H5a5 5 0 0 0-5 5z"/>
                    </svg></button></div>`;
                  }

                  if (data.principal == true) {
                    stats2 = `<div class='col col-6' data-label='Status'><button onclick="alterarStatuspad('${id}', '${cep}', '${logradouro}','${numero}', '${bairro}', '${cidade}', '${uf}', '${status}', '${principal}', '${i}')" id="botaos"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-on" viewBox="0 0 16 16">
                    <path d="M5 3a5 5 0 0 0 0 10h6a5 5 0 0 0 0-10H5zm6 9a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                    </svg></button></div>`;
                  } else {
                    stats2 = `<div class='col col-6' data-label='Status'><button onclick="alterarStatuspad('${id}', '${cep}', '${logradouro}','${numero}', '${bairro}', '${cidade}', '${uf}', '${status}', '${principal}', '${i}')" id="botaos"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-off" viewBox="0 0 16 16">
                    <path d="M11 4a4 4 0 0 1 0 8H8a4.992 4.992 0 0 0 2-4 4.992 4.992 0 0 0-2-4h3zm-6 8a4 4 0 1 1 0-8 4 4 0 0 1 0 8zM0 8a5 5 0 0 0 5 5h6a5 5 0 0 0 0-10H5a5 5 0 0 0-5 5z"/>
                    </svg></button></div>`;
                  }
                  
                  body += stats;
                  body+= stats2;
                  body += "</li>";
                  $("#dadso").append(body);
              
              });

              },
              error: function () {
                alert("Fail!");
              },
            });
          })
        </script>
      </ul>
    </div>

    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <form onsubmit="return false" id="formcadend">
          <input type="text" placeholder="CEP" required id="cep" />
          <input type="text" placeholder="logradouro" disabled id="logradouro" />
          <input type="text" placeholder="bairro" id="bairro" disabled />
          <input type="text" placeholder="cidade" id="cidade" disabled />
          <input type="text" placeholder="uf" id="uf" disabled />
          <input type="text" placeholder="Número" id="numero" required />
          <button id="cad">Cadastrar</button>
        </form>

      </div>

    </div>
    <script>
      $(document).ready(function () {

      $.ajax({
        type: "GET",
        url: `http://localhost:8082/cliente/`+localStorage.getItem('id'),
        mimeType: "json",
        success: function (data) {
          const nome = document.getElementById("nome");
          const genero = document.getElementById("genero");
          const datanasc = document.getElementById("nasc");
          const Senha = document.getElementById("fsenha1");
          const confirmasenha = document.getElementById("fsenha2");

          const cep2 = document.getElementById("cep1")
          const logradouro2 = document.getElementById("logradouro1")
          const bairro2 = document.getElementById("bairro1")
          const cidade2 = document.getElementById("cidade1")
          const uf2 = document.getElementById("uf1")
          const numero2 = document.getElementById("numero1")


          nome.value = data.nome;
          genero.value = data.genero;
          datanasc.value = data.dataNascimento;
          Senha.value = data.senha;
          confirmasenha.value = data.confirmSenha;
          cep2.value = data.cep;
          logradouro2.value = data.logradouro;
          bairro2.value = data.bairro;
          cidade2.value = data.cidade;
          uf2.value = data.uf;
          numero2.value = data.numero;
          
          var id = data.id
          var nome1 = data.nome
          var email = data.email
          var cpf = data.cpf
          var cep = data.cep
          var genero1 = data.genero
          var datanasc1 = data.dataNascimento
          var senha1 = data.senha
          var confirmsenha1 = data.confirmSenha
          var logradouro = data.logradouro
          var numero = data.numero
          var bairro = data.bairro
          var cidade = data.cidade
          var uf = data.uf


          $("#editardadosusr").submit(function (e) {
            e.preventDefault();
            if (($('#password').val()) == "" & ($('#password2').val() == "")) {
              var senha = $('#fsenha1').val();
              var confirmSenha = $('#fsenha2').val();
              console.log($('#fsenha1').val())
              console.log($('#fsenha1').val())

            } else {

              var senha = $.md5($('#password').val());
              var confirmSenha = $.md5($('#password2').val());

            }
            var body = {
              id: id,
              nome: $("#nome").val(),
              email: email,
              cpf: cpf,
              cep: cep,
              genero: $("#genero").val(),
              dataNascimento: $("#nasc").val(),
              senha: senha,
              confirmSenha: confirmSenha,
              logradouro: logradouro,
              numero: numero,
              bairro: bairro,
              cidade: cidade,
              uf: uf
            }

            if (senha === confirmSenha) {
              console.log(body);
              $.ajax({
                type: 'POST',
                url: "http://localhost:8082/cliente/editar",
                data: JSON.stringify(body),
                success: function (data) {
                  window.location.reload();
                },
                contentType: "application/json",
                dataType: 'json'
              });

            } else {
              alert("As senhas devem ser iguais!");
            }


          })

        },
        error: function () {
          alert("Fail!");
        },
      });

    })
    </script>
    <script>


    </script>

    <script>
      $('#formcadend').submit(function (e) {
        e.preventDefault();
        $("#cad").attr("disabled", "disabled");
        var cep = $('#cep').val();
        var logradouro = $('#logradouro').val();
        var numero = $('#numero').val();
        var bairro = $('#bairro').val();
        var cidade = $('#cidade').val();
        var uf = $('#uf').val();

        var bodyfat = {
          cep: cep,
          logradouro: logradouro,
          numero: numero,
          bairro: bairro,
          cidade: cidade,
          uf: uf,
          status: true,
          idcliente: localStorage.getItem('id'),
          

        }

        $.ajax({
          type: 'POST',
          url: "http://localhost:8082/endereco",
          data: JSON.stringify(bodyfat),
          success: function (data) {
            location.reload();
          },
          contentType: "application/json",
          dataType: 'json'
        })

      })
    </script>


    <script>
      $('ul li').on('click', function () {
        $('li').removeClass('active');
        $(this).addClass('active');
      });
    </script>
    <script>
      $(document).ready(function () {
        if (localStorage.getItem('token') == null) {
          document.location.href = "http://localhost:8082/loginLoja.html";
        }

        $("#altdados").on('click', function () {
          $('#altdadsf').show();
          $('#contTabela').hide();
          $('#ednfaturamentos').hide();
          console.log("dados")
        })
        $("#altend").on('click', function () {
          $('#altdadsf').hide();
          $('#ednfaturamentos').hide();
          $('#contTabela').show();
        })

        $("#ednfaturamento").on('click', function () {
          $('#altdadsf').hide();
          $('#contTabela').hide();
          $('#ednfaturamentos').show();

        })

        $("#logout").on('click', function () {
          localStorage.clear();
          alert("Voce foi deslogado")
          document.location.href = "http://localhost:8082"
        })

      })
    </script>
    <script>
      // Get the modal
      var modal = document.getElementById("myModal");

      // Get the button that opens the modal
      var btn = document.getElementById("myBtn");

      // Get the <span> element that closes the modal
      var span = document.getElementsByClassName("close")[0];

      // When the user clicks on the button, open the modal
      btn.onclick = function () {
        modal.style.display = "block";
      }

      // When the user clicks on <span> (x), close the modal
      span.onclick = function () {
        modal.style.display = "none";
      }

      // When the user clicks anywhere outside of the modal, close it
      window.onclick = function (event) {
        if (event.target == modal) {
          modal.style.display = "none";
        }
      }
    </script>
    <script>
      $(document).ready(function () {
        $("#cep").on("focusout", function () {

          //Nova variável "cep" somente com dígitos.
          var cep = $(this).val().replace(/\D/g, '');

          //Verifica se campo cep possui valor informado.
          if (cep != "") {

            //Expressão regular para validar o CEP.
            var validacep = /^[0-9]{8}$/;

            //Valida o formato do CEP.
            if (validacep.test(cep)) {

              //Preenche os campos com "..." enquanto consulta webservice.

              //Consulta o webservice viacep.com.br/
              $.getJSON("https://viacep.com.br/ws/" + cep + "/json/?callback=?", function (dados) {

                if (!("erro" in dados)) {
                  //Atualiza os campos com os valores da consulta.
                  $("#logradouro").val(dados.logradouro);
                  $("#bairro").val(dados.bairro);
                  $("#cidade").val(dados.localidade);
                  $("#uf").val(dados.uf);
                } //end if.
                else {
                  //CEP pesquisado não foi encontrado.
                  alert("CEP não encontrado.");
                }
              });
            } //end if.
            else {
              //cep é inválido.
              alert("Formato de CEP inválido.");
            }
          } //end if.
          else {
            //cep sem valor, limpa formulário.

          }
        });
      })
    </script>
    <script>
      function alterarStatus(id, cep, logradouro, numero, bairro, cidade, uf, status,endprin,i) {
        console.log("até aqui ok")
        console.log(i)

        if (status == "true") {
          var prod = {
            id: id,
            cep: cep,
            logradouro: logradouro,
            numero: numero,
            bairro: bairro,
            cidade: cidade,
            uf: uf,
            status: false,
            idcliente: localStorage.getItem('id'),
            principal:endprin
          }
        } else {
          var prod = {
            id: id,
            cep: cep,
            logradouro: logradouro,
            numero: numero,
            bairro: bairro,
            cidade: cidade,
            uf: uf,
            status: true,
            idcliente: localStorage.getItem('id'),
            principal:endprin
          }
        }
        console.log(prod);
        $.ajax({
          type: 'POST',
          url: "http://localhost:8082/endereco",
          data: JSON.stringify(prod),
          success: function (data) {

            window.location.reload();


          },
          contentType: "application/json",
          dataType: 'json'
        })

      }
    </script>
    <script>
      async function alterarStatuspad(id, cep, logradouro, numero, bairro, cidade, uf, status, principal, i) {
          console.log("até aqui ok")
          let idPrincipalTrue = undefined
          let dados = undefined
          await $.ajax({
            type: "GET",
            url: "http://localhost:8082/endereco/" + localStorage.getItem('id'),
            mimeType: "json",
            cache: false,
            success: function (data) {
                $.each(data, function (i, data) {
                    if (data.principal == true) {
                      idPrincipalTrue = data.id
                    }
                });
            },
            error: function () {
                alert("Fail!");
            },
          });
          if (principal == "true") {
              var prod = {
                  id: id,
                  cep: cep,
                  logradouro: logradouro,
                  numero: numero,
                  bairro: bairro,
                  cidade: cidade,
                  uf: uf,
                  status: status,
                  idcliente: localStorage.getItem('id'),
                  principal: false
              }
          } else {
              var prod = {
                  id: id,
                  cep: cep,
                  logradouro: logradouro,
                  numero: numero,
                  bairro: bairro,
                  cidade: cidade,
                  uf: uf,
                  status: status,
                  idcliente: localStorage.getItem('id'),
                  principal: true
              }
          }
          console.log(prod);
          if(idPrincipalTrue != undefined) {
            await $.ajax({
              type: 'POST',
              url: "http://localhost:8082/endereco/" + idPrincipalTrue,
              success: function (data) {
                /* window.location.reload(); */
              },
              contentType: "application/json",
              dataType: 'json'
            })

            $.ajax({
              type: 'POST',
              url: "http://localhost:8082/endereco/editar",
              data: JSON.stringify(prod),
              success: function (data) {
                window.location.reload();
              },
              contentType: "application/json",
              dataType: 'json'
            })
            console.log('editado')
          } else {
            console.log('não tinha nenhum principal')
            $.ajax({
              type: 'POST',
              url: "http://localhost:8082/endereco/editar",
              data: JSON.stringify(prod),
              success: function (data) {
                window.location.reload();
              },
              contentType: "application/json",
              dataType: 'json'
            })
          }
      }
    </script>
</body>


</html>