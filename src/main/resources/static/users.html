<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" type="text/css" href="DataTables/datatables.min.css" />
  <title>Usuários Cadastrados</title>
</head>

<body>
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <div class="Principal">
    <table id="example" class="display" style="width: 100%">
      <thead>
        <tr>
          <th>CodUser</th>
          <th>Nome</th>
          <th>Email</th>
          <th>Grupo</th>
          <th>Status</th>
          <th>Alterar</th>
          <th>Ativar/inativar</th>
        </tr>
      </thead>

      <tbody id="teste">
        <script>
          $(document).ready(function () {
            var stats;
            var tokenstorage = localStorage.getItem('token')
            $.ajax({
              type: "GET",
              url: "http://localhost:8082/user",
              headers: {"Authorization": localStorage.getItem('token')},
              mimeType: "json",
              success: function (data) {
                $.each(data, function (i, data) {
                  var id = data.id;
                  var nome = data.nome;
                  var email = data.email;
                  var grupo = data.grupo;
                  var status = data.status;
                  var senha = data.senha;
                  var confirmSenha = data.confirmSenha;
                  var cpf = data.cpf;
                  var body = "<tr>";
                  body += "<td>" + data.id + "</td>";
                  body += "<td>" + data.nome + "</td>";
                  body += "<td>" + data.email + "</td>";
                  body += "<td>" + data.grupo + "</td>";
                  body += "<td>" + data.status + "</td>";
                  body += `<td><button onclick="editar(${id})" id="botao"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-pen" viewBox="0 0 16 16">
                        <path d="m13.498.795.149-.149a1.207 1.207 0 1 1 1.707 1.708l-.149.148a1.5 1.5 0 0 1-.059 2.059L4.854 14.854a.5.5 0 0 1-.233.131l-4 1a.5.5 0 0 1-.606-.606l1-4a.5.5 0 0 1 .131-.232l9.642-9.642a.5.5 0 0 0-.642.056L6.854 4.854a.5.5 0 1 1-.708-.708L9.44.854A1.5 1.5 0 0 1 11.5.796a1.5 1.5 0 0 1 1.998-.001zm-.644.766a.5.5 0 0 0-.707 0L1.95 11.756l-.764 3.057 3.057-.764L14.44 3.854a.5.5 0 0 0 0-.708l-1.585-1.585z"/>
                        </svg></button></td>`;
                  if (data.status == "ativo") {
                    stats = `<td><button onclick="mudarStatus('${id}','${nome}','${email}','${grupo}','${status}','${senha}','${confirmSenha}','${cpf}')" id="botao"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-on" viewBox="0 0 16 16">
                        <path d="M5 3a5 5 0 0 0 0 10h6a5 5 0 0 0 0-10H5zm6 9a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                        </svg></button></td>`;
                  } else {
                    stats = `<td><button onclick="mudarStatus('${id}','${nome}','${email}','${grupo}','${status}','${senha}','${confirmSenha}','${cpf}')" id="botao"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-toggle-off" viewBox="0 0 16 16">
                        <path d="M11 4a4 4 0 0 1 0 8H8a4.992 4.992 0 0 0 2-4 4.992 4.992 0 0 0-2-4h3zm-6 8a4 4 0 1 1 0-8 4 4 0 0 1 0 8zM0 8a5 5 0 0 0 5 5h6a5 5 0 0 0 0-10H5a5 5 0 0 0-5 5z"/>
                        </svg></button></td>`;
                  }
                  body += stats;
                  body += "</tr>";
                  $("#example tbody").append(body);
                });
                /*DataTables instantiation.*/

                $("#example").DataTable({
                  language: {
                    sProcessing: "Procesando...",
                    sLengthMenu: "Mostrar _MENU_ registros",
                    sZeroRecords: "Não foram encontrados resultados",
                    sEmptyTable: "tabela vazia",
                    sInfo:
                      "Mostrando registros de _START_ a _END_ de um total de _TOTAL_ registros",
                    sInfoEmpty:
                      "Mostrando registros de 0 al 0 de un total de 0 registros",
                    sInfoFiltered:
                      "(filtrado de um total de _MAX_ registros)",
                    sInfoPostFix: "",
                    sSearch: "Buscar:",
                    sUrl: "",
                    sInfoThousands: ",",
                    sLoadingRecords: "Carregando...",
                    oPaginate: {
                      sFirst: "Primero",
                      sLast: "Ultimo",
                      sNext: "Próximo",
                      sPrevious: "Anterior",
                    },
                    oAria: {
                      sSortAscending:
                        ": Activar para ordenar la columna de manera ascendente",
                      sSortDescending:
                        ": Activar para ordenar la columna de manera descendente",
                    },
                  },
                });
              },
              error: function () {
                alert("Fail!");
              },
            });
          });


          //passar url dinamica

          function teste(id) {
            console.log('oiii')

            localStorage.setItem('productId', id)

            window.location = "visualizeProduct.html?produtoId=" + id;
          }

          function mudarStatus(id, nome, email, grupo, status, senha, confirmSenha, cpf) {
            console.log("até aqui ok")
            console.log(arguments[0]);
            if (status == "ativo") {
              var prod = {
                id: id,
                nome: nome,
                email: email,
                grupo: grupo,
                status: "inativo",
                senha: senha,
                confirmSenha: confirmSenha,
                cpf: cpf
              }
            } else {
              var prod = {
                id: id,
                nome: nome,
                email: email,
                grupo: grupo,
                status: "ativo",
                senha: senha,
                confirmSenha: confirmSenha,
                cpf: cpf
              }
            }
            console.log(prod);
            $.ajax({
              url: 'http://localhost:8082/user/editar',
              type: 'post',
              dataType: 'json',
              contentType: 'application/json',
              success: function (data) {
                $('#target').html(data.msg);

              },
              data: JSON.stringify(prod)
            });
            window.location.reload();
          }

          function editar(id) {
            console.log('oiii')

            localStorage.setItem('userId', id)

            window.location = "editUser.html?userId=" + id;
          }
        </script>
      </tbody>
      <tfoot>
        <tr>
          <th>CodUser</th>
          <th>Nome</th>
          <th>Email</th>
          <th>Grupo</th>
          <th>Status</th>
          <th>Alterar</th>
          <th>Ativar/inativar</th>
        </tr>
      </tfoot>
    </table>

    <a href="createUser.html" id="botao" class="add-new-product mt-3">
      Adicionar novo usuário
    </a>
  </div>

  <script type="text/javascript" src="script.js"></script>
  <script type="text/javascript" src="DataTables/datatables.min.js"></script>
</body>

</html>